{{ define "content" }}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <div>
            <div class="flex items-center gap-2 text-sm text-zinc-500 mb-2">
                <a href="/buckets" class="hover:text-white">Buckets</a>
                <span>/</span>
                <a href="/buckets/{{ .BucketName }}" class="hover:text-white">{{ .BucketName }}</a>
                <span>/</span>
                <span class="text-white">Settings</span>
            </div>
            <h1 class="text-2xl font-bold text-white">Bucket Settings</h1>
            <p class="text-zinc-400 text-sm mt-1">Configure settings for {{ .BucketName }}</p>
        </div>
        <a href="/buckets/{{ .BucketName }}" class="bg-zinc-800 hover:bg-zinc-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center gap-2">
            <i data-lucide="arrow-left" size="16"></i> Back to Browser
        </a>
    </div>

    <!-- Settings Sections -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Versioning -->
        <div class="bg-surface border border-border rounded-xl p-6">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-zinc-800/50 rounded-lg text-zinc-400">
                        <i data-lucide="git-branch" size="20"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">Versioning</h3>
                        <p class="text-xs text-zinc-500">Keep multiple versions of objects</p>
                    </div>
                </div>
                {{ if eq .VersioningStatus "Enabled" }}
                <span class="text-xs bg-emerald-500/10 text-emerald-400 px-2 py-1 rounded">Enabled</span>
                {{ else if eq .VersioningStatus "Suspended" }}
                <span class="text-xs bg-yellow-500/10 text-yellow-400 px-2 py-1 rounded">Suspended</span>
                {{ else }}
                <span class="text-xs bg-zinc-500/10 text-zinc-400 px-2 py-1 rounded">Disabled</span>
                {{ end }}
            </div>

            <p class="text-sm text-zinc-400 mb-4">
                When versioning is enabled, MinIO keeps multiple versions of an object in the same bucket.
                This allows you to recover objects from accidental deletion or overwrite.
            </p>

            <div class="flex gap-2">
                {{ if not .VersioningEnabled }}
                <button
                    hx-post="/buckets/{{ .BucketName }}/versioning/enable"
                    hx-confirm="Enable versioning for '{{ .BucketName }}'? This cannot be undone - versioning can only be suspended, not disabled."
                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                    Enable Versioning
                </button>
                {{ else }}
                <button
                    hx-post="/buckets/{{ .BucketName }}/versioning/suspend"
                    hx-confirm="Suspend versioning for '{{ .BucketName }}'? Existing versions will be preserved but new versions won't be created."
                    class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                    Suspend Versioning
                </button>
                {{ end }}
            </div>

            {{ if .VersioningEnabled }}
            <div class="mt-4 p-3 bg-zinc-800/50 rounded-lg">
                <div class="flex items-start gap-2">
                    <i data-lucide="info" size="16" class="text-zinc-500 mt-0.5"></i>
                    <p class="text-xs text-zinc-400">
                        Once enabled, versioning cannot be disabled - only suspended.
                        Suspending versioning preserves existing versions but stops creating new ones.
                    </p>
                </div>
            </div>
            {{ end }}
        </div>

        <!-- Lifecycle Rules -->
        <div class="bg-surface border border-border rounded-xl p-6" x-data="{ showForm: false }">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-zinc-800/50 rounded-lg text-zinc-400">
                        <i data-lucide="clock" size="20"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">Lifecycle Rules</h3>
                        <p class="text-xs text-zinc-500">Automatic object expiration</p>
                    </div>
                </div>
                <button @click="showForm = !showForm" class="text-xs bg-accent/10 text-accent px-2 py-1 rounded hover:bg-accent/20 transition-colors">
                    <i data-lucide="plus" size="12" class="inline"></i> Add Rule
                </button>
            </div>

            <p class="text-sm text-zinc-400 mb-4">
                Configure rules to automatically delete objects based on age.
            </p>

            <!-- Add Rule Form -->
            <div x-show="showForm" x-cloak class="mb-4 p-4 bg-zinc-800/50 rounded-lg border border-zinc-700">
                <form hx-post="/buckets/{{ .BucketName }}/lifecycle" class="space-y-3">
                    <div>
                        <label class="block text-xs text-zinc-500 mb-1">Rule ID</label>
                        <input type="text" name="id" required placeholder="e.g., expire-logs"
                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-white placeholder-zinc-500 focus:border-accent focus:outline-none" />
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-500 mb-1">Prefix Filter (optional)</label>
                        <input type="text" name="prefix" placeholder="e.g., logs/"
                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-white placeholder-zinc-500 focus:border-accent focus:outline-none" />
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-500 mb-1">Delete After (days)</label>
                        <input type="number" name="expirationDays" required min="1" placeholder="30"
                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-white placeholder-zinc-500 focus:border-accent focus:outline-none" />
                    </div>
                    <div class="flex gap-2">
                        <button type="submit" class="bg-accent hover:bg-accent/80 text-white px-3 py-1.5 rounded-lg text-sm font-medium transition-colors">
                            Add Rule
                        </button>
                        <button type="button" @click="showForm = false" class="bg-zinc-700 hover:bg-zinc-600 text-white px-3 py-1.5 rounded-lg text-sm font-medium transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>

            <!-- Rules List -->
            <div hx-get="/buckets/{{ .BucketName }}/lifecycle" hx-trigger="load" hx-swap="innerHTML">
                <div class="text-center py-4">
                    <div class="animate-spin w-5 h-5 border-2 border-zinc-600 border-t-accent rounded-full mx-auto"></div>
                </div>
            </div>
        </div>

        <!-- Notifications -->
        <div class="bg-surface border border-border rounded-xl p-6">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-zinc-800/50 rounded-lg text-zinc-400">
                        <i data-lucide="bell" size="20"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">Event Notifications</h3>
                        <p class="text-xs text-zinc-500">Webhooks for bucket events</p>
                    </div>
                </div>
            </div>
            <p class="text-sm text-zinc-400 mb-4">
                Notifications are sent when objects are created, deleted, or accessed.
            </p>
            <div hx-get="/buckets/{{ .BucketName }}/notifications" hx-trigger="load" hx-swap="innerHTML">
                <div class="text-center py-4">
                    <div class="animate-spin w-5 h-5 border-2 border-zinc-600 border-t-accent rounded-full mx-auto"></div>
                </div>
            </div>
        </div>

        <!-- Replication -->
        <div class="bg-surface border border-border rounded-xl p-6">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-zinc-800/50 rounded-lg text-zinc-400">
                        <i data-lucide="copy" size="20"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">Replication</h3>
                        <p class="text-xs text-zinc-500">Cross-bucket replication</p>
                    </div>
                </div>
            </div>
            <p class="text-sm text-zinc-400 mb-4">
                Automatically replicate objects to another bucket for disaster recovery.
            </p>
            <div hx-get="/buckets/{{ .BucketName }}/replication" hx-trigger="load" hx-swap="innerHTML">
                <div class="text-center py-4">
                    <div class="animate-spin w-5 h-5 border-2 border-zinc-600 border-t-accent rounded-full mx-auto"></div>
                </div>
            </div>
        </div>

        <!-- Quota -->
        <div class="bg-surface border border-border rounded-xl p-6">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-zinc-800/50 rounded-lg text-zinc-400">
                        <i data-lucide="gauge" size="20"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">Storage Quota</h3>
                        <p class="text-xs text-zinc-500">Limit bucket storage usage</p>
                    </div>
                </div>
            </div>
            <p class="text-sm text-zinc-400 mb-4">
                Set a maximum storage limit for this bucket.
            </p>
            <div hx-get="/buckets/{{ .BucketName }}/quota" hx-trigger="load" hx-swap="innerHTML">
                <div class="text-center py-4">
                    <div class="animate-spin w-5 h-5 border-2 border-zinc-600 border-t-accent rounded-full mx-auto"></div>
                </div>
            </div>
        </div>

        <!-- Bucket Policy -->
        <div class="bg-surface border border-border rounded-xl p-6 lg:col-span-2">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-zinc-800/50 rounded-lg text-zinc-400">
                        <i data-lucide="shield" size="20"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">Bucket Policy</h3>
                        <p class="text-xs text-zinc-500">Configure access permissions</p>
                    </div>
                </div>
            </div>
            <p class="text-sm text-zinc-400 mb-4">
                Bucket policies define who can access objects in this bucket and what actions they can perform.
            </p>
            <div id="policy-section" class="space-y-4" x-data="{
                policyType: '{{ .PolicyType }}',
                customPolicy: '',
                showEditor: {{ if eq .PolicyType "custom" }}true{{ else }}false{{ end }},
                init() {
                    const el = this.$refs.policyData;
                    if (el && el.value) this.customPolicy = el.value;
                }
            }">
                <textarea x-ref="policyData" class="hidden">{{ .FormattedPolicy }}</textarea>

                {{ if .HasPolicy }}
                <div class="bg-zinc-800/50 rounded-lg p-3">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-zinc-500 text-xs">Current Policy</span>
                        {{ if eq .PolicyType "private" }}
                        <span class="text-xs bg-zinc-500/10 text-zinc-400 px-2 py-0.5 rounded">Private</span>
                        {{ else if eq .PolicyType "public-read" }}
                        <span class="text-xs bg-emerald-500/10 text-emerald-400 px-2 py-0.5 rounded">Public Read</span>
                        {{ else if eq .PolicyType "public-read-write" }}
                        <span class="text-xs bg-yellow-500/10 text-yellow-400 px-2 py-0.5 rounded">Public Read/Write</span>
                        {{ else }}
                        <span class="text-xs bg-accent/10 text-accent px-2 py-0.5 rounded">Custom</span>
                        {{ end }}
                    </div>
                    <pre class="text-xs text-zinc-300 overflow-x-auto max-h-48 overflow-y-auto bg-zinc-900 rounded p-2 font-mono">{{ .FormattedPolicy }}</pre>
                </div>
                {{ else }}
                <div class="text-center py-4 text-zinc-500">
                    <i data-lucide="lock" size="24" class="mx-auto mb-2 opacity-50"></i>
                    <p class="text-sm">No policy configured (Private)</p>
                    <p class="text-xs mt-1">Only the bucket owner can access objects</p>
                </div>
                {{ end }}

                <form hx-post="/buckets/{{ .BucketName }}/policy" hx-target="#policy-section" hx-swap="outerHTML" class="space-y-4 pt-4 border-t border-zinc-700">
                    <div>
                        <label class="block text-xs text-zinc-500 mb-2">Access Policy</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center gap-2 p-3 bg-zinc-800/50 rounded-lg cursor-pointer border border-transparent hover:border-zinc-600 transition-colors"
                                :class="{ 'border-accent': policyType === 'private' }">
                                <input type="radio" name="policyType" value="private" x-model="policyType" @change="showEditor = false"
                                    class="text-accent focus:ring-accent" />
                                <div>
                                    <div class="text-sm text-white font-medium">Private</div>
                                    <div class="text-xs text-zinc-500">Owner only</div>
                                </div>
                            </label>
                            <label class="flex items-center gap-2 p-3 bg-zinc-800/50 rounded-lg cursor-pointer border border-transparent hover:border-zinc-600 transition-colors"
                                :class="{ 'border-accent': policyType === 'public-read' }">
                                <input type="radio" name="policyType" value="public-read" x-model="policyType" @change="showEditor = false"
                                    class="text-accent focus:ring-accent" />
                                <div>
                                    <div class="text-sm text-white font-medium">Public Read</div>
                                    <div class="text-xs text-zinc-500">Anyone can read</div>
                                </div>
                            </label>
                            <label class="flex items-center gap-2 p-3 bg-zinc-800/50 rounded-lg cursor-pointer border border-transparent hover:border-zinc-600 transition-colors"
                                :class="{ 'border-accent': policyType === 'public-read-write' }">
                                <input type="radio" name="policyType" value="public-read-write" x-model="policyType" @change="showEditor = false"
                                    class="text-accent focus:ring-accent" />
                                <div>
                                    <div class="text-sm text-white font-medium">Public Read/Write</div>
                                    <div class="text-xs text-zinc-500">Anyone can read/write</div>
                                </div>
                            </label>
                            <label class="flex items-center gap-2 p-3 bg-zinc-800/50 rounded-lg cursor-pointer border border-transparent hover:border-zinc-600 transition-colors"
                                :class="{ 'border-accent': policyType === 'custom' }">
                                <input type="radio" name="policyType" value="custom" x-model="policyType" @change="showEditor = true"
                                    class="text-accent focus:ring-accent" />
                                <div>
                                    <div class="text-sm text-white font-medium">Custom</div>
                                    <div class="text-xs text-zinc-500">JSON policy</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div x-show="showEditor" x-cloak class="space-y-2">
                        <label class="block text-xs text-zinc-500">Policy JSON</label>
                        <textarea name="policy" x-model="customPolicy" rows="10"
                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-white font-mono placeholder-zinc-500 focus:border-accent focus:outline-none"
                            placeholder='{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {"AWS": ["*"]},
      "Action": ["s3:GetObject"],
      "Resource": ["arn:aws:s3:::{{ .BucketName }}/*"]
    }
  ]
}'></textarea>
                        <p class="text-xs text-zinc-500">
                            <i data-lucide="info" size="12" class="inline mr-1"></i>
                            Use AWS IAM policy format. Leave empty to remove the policy.
                        </p>
                    </div>

                    <div class="flex gap-2">
                        <button type="submit" class="bg-accent hover:bg-accent/80 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="save" size="14" class="inline mr-1"></i>
                            Apply Policy
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{{ end }}
