{{ define "confirm_dialog" }}
<!-- Styled Confirm Dialog -->
<dialog id="confirm-dialog" class="bg-transparent p-0 m-0 max-w-none w-full h-full backdrop:bg-black/60">
    <div class="fixed inset-0 flex items-center justify-center p-4">
        <div class="bg-surface border border-border rounded-xl p-6 w-full max-w-md shadow-2xl">
            <div class="flex items-start gap-4">
                <!-- Icon -->
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center">
                    <i data-lucide="alert-triangle" size="20" class="text-red-400"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <h3 id="confirm-dialog-title" class="text-lg font-semibold text-white mb-2">Confirm Action</h3>
                    <p id="confirm-dialog-message" class="text-sm text-zinc-400"></p>
                </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-3 mt-6">
                <button
                    type="button"
                    id="confirm-dialog-cancel"
                    class="flex-1 bg-zinc-800 hover:bg-zinc-700 text-white px-4 py-2.5 rounded-lg text-sm font-medium transition-colors">
                    Cancel
                </button>
                <button
                    type="button"
                    id="confirm-dialog-confirm"
                    class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2.5 rounded-lg text-sm font-medium transition-colors">
                    Confirm
                </button>
            </div>
        </div>
    </div>
</dialog>

<script>
(function() {
    const dialog = document.getElementById('confirm-dialog');
    const messageEl = document.getElementById('confirm-dialog-message');
    const cancelBtn = document.getElementById('confirm-dialog-cancel');
    const confirmBtn = document.getElementById('confirm-dialog-confirm');

    let resolvePromise = null;

    // Close dialog on cancel
    cancelBtn.addEventListener('click', () => {
        dialog.close();
        if (resolvePromise) resolvePromise(false);
    });

    // Close dialog on confirm
    confirmBtn.addEventListener('click', () => {
        dialog.close();
        if (resolvePromise) resolvePromise(true);
    });

    // Close on backdrop click
    dialog.addEventListener('click', (e) => {
        if (e.target === dialog) {
            dialog.close();
            if (resolvePromise) resolvePromise(false);
        }
    });

    // Close on Escape key
    dialog.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            dialog.close();
            if (resolvePromise) resolvePromise(false);
        }
    });

    // Override HTMX's confirm behavior - only for elements with hx-confirm
    document.body.addEventListener('htmx:confirm', function(e) {
        // Only intercept if there's actually a confirm question
        if (!e.detail.question) {
            return; // Let HTMX proceed normally
        }

        e.preventDefault();

        const message = e.detail.question;
        messageEl.textContent = message;

        // Re-init icons in dialog
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }

        dialog.showModal();

        // Create a promise that resolves when user makes a choice
        new Promise((resolve) => {
            resolvePromise = resolve;
        }).then((confirmed) => {
            if (confirmed) {
                e.detail.issueRequest(true);
            }
        });
    });
})();
</script>
{{ end }}
